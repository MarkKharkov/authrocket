function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _get=function(e,r,t){for(var n=!0;n;){var o=e,i=r,s=t;u=l=c=void 0,n=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var c=u.get;return void 0===c?void 0:c.call(s)}var l=Object.getPrototypeOf(o);if(null===l)return void 0;e=l,r=i,t=s,n=!0}},_createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}();!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("lodash"),require("superagent")):"function"==typeof define&&define.amd?define(["lodash","superagent"],r):e.AuthRocket=r(e._,e.superagent)}(this,function(e,r){"use strict";function t(r){return e.isString(r)?r.replace(/\/$/,""):(logger.error({description:"Slash can only be removed from strings.",func:"removeTrailingSlash",file:"config"}),r)}function n(e,r){return e&&console[e]?console[e].apply(console,r):console.log.apply(console,r)}function o(e){var r="",t={};l.isObject(e)?("debug"==g.logLevel&&l.has(e,"func")&&(r+=l.has(e,"obj")?"["+e.obj+"."+e.func+"()]\n ":l.has(e,"file")?"["+e.file+" > "+e.func+"()]\n ":"["+e.func+"()]\n "),l.each(l.omit(l.keys(e)),function(n){"func"!=n&&"obj"!=n&&("description"==n||"message"==n?r+=e[n]:l.isString(e[n])?t[n]=e[n]:t[n]=e[n])}),r+="\n"):l.isString(e)&&(r=e);var n=[r,t];return n}function i(e,r){return"undefined"==typeof r||r?u(e):e}function s(e){return new Promise(function(r,t){e.end(function(e,n){return e?(v.warn({description:"Error response.",error:e,func:"handleResponse"}),401==e.status&&v.warn({description:"Unauthorized. You must be signed into make this request.",func:"handleResponse"}),t(e&&e.response?e.response.text:e&&e.errno?e.errno:e)):r(n.body)})})}function u(r){var t=r;if(!g.accountId||!g.apiKey||!g.realmId)return v.error({description:"AccountId, apiKey, and realmId are required.",func:"addAuthRocketHeaders"}),r;var n={"X-Authrocket-Account":g.accountId,"X-Authrocket-Api-Key":g.apiKey,"X-Authrocket-Realm":g.realmId,"Content-Type":"application/json"};return v.log({description:"addAuthRocketHeaders called.",config:g}),e.each(e.keys(n),function(e){t=c(r,e,n[e])}),v.log({description:"addAuthRocketHeaders request created.",func:"addAuthRocketHeaders"}),t}function c(e,r,t){return r&&t?(v.log({description:"Header value set.",headerName:r,headerVal:t}),e.set(r,t)):void v.error({description:"Header name and value required to add header to request.",func:"addHeaderToReq",obj:"request"})}var l="default"in e?e["default"]:e;r="default"in r?r["default"]:r;var a={accountId:process.env.AUTHROCKET_ACCOUNT_ID,apiKey:process.env.AUTHROCKET_API_KEY,realmId:process.env.AUTHROCKET_REALM_ID,jwtSecret:process.env.AUTHROCKET_JWT_SECRET,apiUrl:process.env.AUTHROCKET_API_URL||"https://api-e1.authrocket.com/v1/",jsUrl:process.env.AUTHROCKET_JS_URL},f="prod",p=null,d=null,h=function(){function r(){return _classCallCheck(this,r),d||(d=this),e.merge(d,a)}return _createClass(r,[{key:"applySettings",value:function(r){var t=this;e.each(e.keys(r),function(e){t[e]=r[e]})}},{key:"logLevel",set:function(e){p=e},get:function(){return p?p:a.envs[f].logLevel}},{key:"envName",set:function(e){f=e}},{key:"env",get:function(){return a.envs[f]}},{key:"urls",get:function(){var e=this.jsUrl,r=this.apiUrl;return Object.defineProperties({},{api:{get:function(){return r?t(r):null},configurable:!0,enumerable:!0},js:{get:function(){return e?t(e):null},configurable:!0,enumerable:!0}})}}]),r}(),g=new h,v={log:function(e){var r=o(e);"trace"===g.logLevel&&n("log",r)},debug:function(e){var r=o(e);("trace"===g.logLevel||"debug"===g.logLevel)&&n("debug",r)},info:function(e){if("trace"===g.logLevel||"debug"===g.logLevel||"info"===g.logLevel){var r=o(e);n("info",r)}},warn:function(e){var r=o(e);("trace"===g.logLevel||"debug"===g.logLevel||"info"===g.logLevel||"warn"===g.logLevel)&&n("warn",r)},error:function(e){var r=o(e);("trace"===g.logLevel||"debug"===g.logLevel||"info"===g.logLevel||"warn"===g.logLevel||"error"===g.logLevel||"fatal"===g.logLevel)&&n("error",r)}},y={get:function(e,t,n){var o=r.get(e);return t&&o.query(t),o=i(o,n),s(o)},post:function(e,t,n){var o=r.post(e).send(t);return o=i(o,n),s(o)},put:function(e,t,n){var o=r.put(e,t);return o=i(o,n),s(o)},del:function(e,t,n){var o=r.put(e,t);return o=i(o,n),s(o)}},j=function(){function r(e,t,n){_classCallCheck(this,r),this.name=e,this.endpoint=n?n:""+this.name,this.init(t)}return _createClass(r,[{key:"init",value:function(r){v.log({description:"Init action called.",actionData:r,func:"url",obj:"Action"}),this.isList=r?!1:!0,this.isList||(this.actionData=r,e.isString(r)?this.id=this.actionData:e.has(r,"id")||e.has(r,"username")?this.id=r.id?r.id:r.username:(v.warn({description:"Invalid action data object.",func:"constructor",obj:"Action"}),this.isList=!1))}},{key:"get",value:function(){return y.get(this.url).then(function(r){return v.log({description:"Get responded successfully.",res:r,func:"get",obj:"Action"}),e.has(r,"error")?(v.error({description:"Error in get response.",error:r.error,res:r,func:"get",obj:"Action"}),Promise.reject(r.error)):r.collection?r.collection:r},function(e){return v.error({description:"Error in GET request.",error:e,func:"get",obj:"Action"}),Promise.reject(e)})}},{key:"add",value:function(r){return y.post(this.url,r).then(function(r){return v.log({description:"Add request responded successfully.",res:r,func:"add",obj:"Action"}),e.has(r,"error")?(v.error({description:"Error creating new user.",error:r.error,res:r,func:"add",obj:"Action"}),Promise.reject(r.error)):(v.log({description:"Add successful.",res:r,func:"add",obj:"Action"}),r)},function(e){return v.error({description:"Error creating new user.",error:e,func:"add",obj:"Action"}),Promise.reject(e)})}},{key:"update",value:function(r){return y.put(this.url,r).then(function(r){return e.has(r,"error")?(v.error({description:"Error in update request.",error:r.error,res:r,func:"update",obj:"Action"}),Promise.reject(r.error)):(v.log({description:"Update successful.",res:r,func:"update",obj:"Action"}),r)},function(e){return v.error({description:"Error in update request.",error:e,func:"update",obj:"Action"}),Promise.reject(e)})}},{key:"remove",value:function(){return y.del(this.url).then(function(r){return e.has(r,"error")?(v.error({description:"Error in request for removal.",error:r.error,res:r,func:"remove",obj:"Action"}),Promise.reject(r.error)):(v.log({description:"Remove successfully.",res:r,func:"remove",obj:"Action"}),r)},function(e){return v.error({description:"Error in request for removal.",error:e,func:"remove",obj:"Action"}),Promise.reject(e)})}},{key:"url",get:function(){var e=this.isList?g.urls.api+"/"+this.endpoint:g.urls.api+"/"+this.endpoint+"/"+this.id;return v.log({description:"Url created.",url:e,func:"url",obj:"Action"}),e}}]),r}(),k=function(e){function r(e){_classCallCheck(this,r),_get(Object.getPrototypeOf(r.prototype),"constructor",this).call(this,"realms",e)}return _inherits(r,e),r}(j),b=function(e){function r(e){_classCallCheck(this,r),_get(Object.getPrototypeOf(r.prototype),"constructor",this).call(this,"users",e)}return _inherits(r,e),r}(j),m=function(e){function r(e){_classCallCheck(this,r),_get(Object.getPrototypeOf(r.prototype),"constructor",this).call(this,"credentials",e)}return _inherits(r,e),r}(j),_=function(e){function r(e){_classCallCheck(this,r),_get(Object.getPrototypeOf(r.prototype),"constructor",this).call(this,"signup_tokens",e)}return _inherits(r,e),r}(j),A=function(e){function r(e){_classCallCheck(this,r),_get(Object.getPrototypeOf(r.prototype),"constructor",this).call(this,"orgs",e)}return _inherits(r,e),r}(j),C=function(e){function r(e){_classCallCheck(this,r),_get(Object.getPrototypeOf(r.prototype),"constructor",this).call(this,"memberships",e)}return _inherits(r,e),r}(j),O=function(e){function r(e){_classCallCheck(this,r),_get(Object.getPrototypeOf(r.prototype),"constructor",this).call(this,"auth_providers",e)}return _inherits(r,e),r}(j),P=function(e){function r(e){_classCallCheck(this,r),_get(Object.getPrototypeOf(r.prototype),"constructor",this).call(this,"login_policies",e)}return _inherits(r,e),r}(j),w=function(e){function r(e){_classCallCheck(this,r),_get(Object.getPrototypeOf(r.prototype),"constructor",this).call(this,"app_hooks",e)}return _inherits(r,e),r}(j),E=function(e){function r(e){_classCallCheck(this,r),_get(Object.getPrototypeOf(r.prototype),"constructor",this).call(this,"session",e)}return _inherits(r,e),r}(j),R=function(e){function r(e){_classCallCheck(this,r),_get(Object.getPrototypeOf(r.prototype),"constructor",this).call(this,"events",e)}return _inherits(r,e),r}(j),T=function(e){function r(e){_classCallCheck(this,r),_get(Object.getPrototypeOf(r.prototype),"constructor",this).call(this,"notifications",e)}return _inherits(r,e),r}(j),L=function(){function e(r){_classCallCheck(this,e),r&&l.isString(r)?this.apiUrl=r:g.applySettings(r)}return _createClass(e,[{key:"login",value:function(e){return l.has(e,"username")&&l.has(e,"password")?(v.log({description:"Calling login.",url:g.urls.js+"/login",loginData:e,func:"login",obj:"AuthRocket"}),y.post(g.urls.js+"/login",e,!1).then(function(e){if(l.has(e,"error"))return v.error({description:"Error logging in.",error:e.error,res:e,func:"login",obj:"AuthRocket"}),Promise.reject(e.error);if(l.has(e,"errno")){var r=e.errno,t="Error logging in.";return"ENOTFOUND"===r&&(r="User not found.",t=r),v.error({description:r,error:e.errno,res:e,func:"login",obj:"AuthRocket"}),Promise.reject(r)}return e},function(e){return v.error({description:"Error logging in.",error:e,func:"login",obj:"AuthRocket"}),"ENOTFOUND"===e&&(e="User not found."),Promise.reject(e)})):(v.error({description:"Username and password are required to login.",func:"login",obj:"AuthRocket"}),Promise.reject("Username/Email and password are required."))}},{key:"logout",value:function(e){return e&&l.isString(e)?y.post(g.urls.js+"/logout",{token:e},!1).then(function(e){return l.has(e,"error")||l.has(e,"errno")?(v.error({description:"Error logging out.",error:e.error||e.errno,res:e,func:"logout",obj:"AuthRocket"}),Promise.reject(e.error||e.errno)):(v.log({description:"Successful logout.",res:e,func:"logout",obj:"AuthRocket"}),e)},function(e){return v.error({description:"Error logging out.",error:e}),Promise.reject(e)}):(v.error({description:"Token string is required to logout.",func:"logout",obj:"AuthRocket"}),Promise.reject("Valid token is required to logout."))}},{key:"signup",value:function(e){return(l.has(e,"username")||l.has(e,"email"))&&l.has(e,"username")?y.post(g.urls.js+"/signup",e).then(function(e){return l.has(e,"error")||l.has(e,"errno")?(v.error({description:"Error signing up.",error:e.error||e.errno,res:e,func:"signup",obj:"AuthRocket"}),Promise.reject(e.error||e.errno)):(v.log({description:"Successful signup",res:e,func:"signup",obj:"AuthRocket"}),e)},function(e){return v.error({description:"Error signing up.",error:e,func:"signup",obj:"AuthRocket"}),Promise.reject(e)}):(v.error({description:"Username/Email and password are required to login.",func:"login",obj:"AuthRocket"}),Promise.reject("Username/Email and password are required."))}},{key:"verify",value:function(e){return y.get(g.urls.api+"/sessions/"+e).then(function(e){return v.log({description:"Token/Session is valid.",res:e,func:"verify",obj:"AuthRocket"}),l.has(e,"error")?(v.error({description:"Error verifying token/session.",error:e.error,res:e,func:"verify",obj:"AuthRocket"}),Promise.reject(e.error)):e},function(e){return v.error({description:"Token/Session is invalid.",error:e,func:"verify",obj:"AuthRocket"}),Promise.reject(e)})}},{key:"Realms",value:function(e){return new k(e)}},{key:"Users",value:function(e){return new b(e)}},{key:"Credentials",value:function(e){return new m(e)}},{key:"SignupTokens",value:function(e){return new _(e)}},{key:"Orgs",value:function(e){return new A(e)}},{key:"Memberships",value:function(e){return new C(e)}},{key:"AuthProviders",value:function(e){return new O(e)}},{key:"ConnectedApps",value:function(e){return new P(e)}},{key:"Hooks",value:function(e){return new w(e)}},{key:"Sessions",value:function(e){return new E(e)}},{key:"Events",value:function(e){return new R(e)}},{key:"Notifications",value:function(e){return new T(e)}}]),e}();return L});
//# sourceMappingURL=authrocket.min.js.map
